---


- name: Install common cross-distro packages
  become: true
  package:
    name:
      - gimp
      - vlc
      - tcpdump
      - stow
      - neofetch
      - vim
      - net-tools
      - gnome-tweaks
      - dconf-editor
      - cmake
      - python3-pip


- name: Install common pip packages
  become: true
  pip:
    name:
      - virtualenv



# --------------------------
# -- Fedora only installs --
# --------------------------

# - name: dnf - Add tailscale repo
#   when: ansible_distribution == 'Fedora'
#   become: true
#   community.general.dnf_config_manager:
#     name: tailscale
#     baseurl: https://pkgs.tailscale.com/stable/fedora/tailscale.repo
#     enabled: yes

- name: dnf - Install packages
  when: ansible_distribution == 'Fedora'
  become: true
  dnf:
    name:
      - stlink
      - ffmpeg-free
      - input-remapper
      - dnf5






# --------------------------
# -- Debian only installs --
# --------------------------
- name: apt - Install packages
  when: ansible_distribution == 'Pop!_OS' or ansible_distribution == 'Ubuntu'
  become: true
  apt:
    name:
      - stlink-tools
      - ffmpeg

- name: apt - Install Input Remapper 
  when: ansible_distribution == 'Pop!_OS' or ansible_distribution == 'Ubuntu'
  become: true
  apt:
    deb: "{{item}}"
  with_items:
    - "https://github.com/sezanzeb/input-remapper/releases/download/2.0.1/input-remapper-2.0.1.deb"

- name: apt - Tailscale dependencies
  when: ansible_distribution == 'Pop!_OS' or ansible_distribution == 'Ubuntu'
  become: true
  ansible.builtin.apt:
    name:
      - gnupg2
      - gnupg-agent
      - apt-transport-https
      - python3-apt
    cache_valid_time: 3600

- name: apt - Add Tailscale Signing Key
  when: ansible_distribution == 'Pop!_OS' or ansible_distribution == 'Ubuntu'
  become: true
  ansible.builtin.get_url:
    url: https://pkgs.tailscale.com/stable/ubuntu/jammy.noarmor.gpg
    dest: /usr/share/keyrings/tailscale-archive-keyring.gpg
    mode: '0644'

- name: apt - Add Tailscale Deb
  when: ansible_distribution == 'Pop!_OS' or ansible_distribution == 'Ubuntu'
  become: true
  ansible.builtin.apt_repository:
    repo:  deb [signed-by=/usr/share/keyrings/tailscale-archive-keyring.gpg] https://pkgs.tailscale.com/stable/ubuntu jammy main

- name: apt - Install Tailscale
  when: ansible_distribution == 'Pop!_OS' or ansible_distribution == 'Ubuntu'
  become: true
  ansible.builtin.apt:
    name: tailscale
    cache_valid_time: 3600


# - name: Install Debian only packages
#   when: ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu'
#   become: true
#   apt:
#     update_cache: true
#     name:
#       - stlink-tools
#       - ffmpeg


# - name: Install Red Hat only packages
#   when: ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu'
#   become: true
#   apt:
#     update_cache: true
#     name:
#       - stlink-tools
#       - ffmpeg



# dnf only: 
# - ffmpeg-free
# - stlink

# dnf find:
#       - build-essential


# ----------------------
# apt installs
# ----------------------
# - name: Install debian apps through apt
#   become: yes
#   apt:
#     update_cache: yes
#     state: present
#     name:
#       - ffmpeg
#       - build-essential
#       - libcap-dev
#       - arping
#       - x11-utils
#       - libssl-dev
#       # - virtualbox
#       # - valgrind
#       # - gdbserver
#       # --- PlatformIO ----
#       - stlink-tools
#       - wireshark
#       # --- ProtonVPN ---
#       - libayatana-appindicator3-1
#       - gir1.2-ayatanaappindicator3-0.1
#       - gnome-shell-extension-appindicator
#       - nala
#   tags: apps


# ----------------------
# install deb-get
# ----------------------
# - name: Install deb-get
#   shell: "curl -sL https://raw.githubusercontent.com/wimpysworld/deb-get/main/deb-get | sudo -E bash -s install deb-get"
#   tags: apps

# ----------------------
# deb-get installs
# ----------------------
# - name: Install Apps available through deb-get
#   shell: "deb-get install {{item}}"
#   with_items:
#     - "discord"
#     - "code"
#     - "codium"
#     - "docker-ce"
#     - "draw.io"
#     - "signal-desktop"
#     - "tailscale"
#     - "protonvpn"
    # - "pandoc"
    # - "brave-browser"
    # - "rpi-imager"
    # - "portmaster"
    # - "spotify-client"
    # - "obs-studio"
    # - "virtualbox-6.1"
  # tags: apps






# --------------------------------------
# FLATPAK INSTALLS
# --------------------------------------
# - name: Flatpak Installs
#   flatpak:
#     name: "{{item}}"
#   with_items:
#     # - "com.mattjakeman.ExtensionManager"
#     # - "org.gnome.Boxes"
#     # - "com.usebottles.bottles"
#     # - "org.DolphinEmu.dolphin-emu"
#     # - "org.inkscape.Inkscape"
#     # - "org.audacityteam.Audacity"
#     # - "org.kicad.KiCad"
#     # - "cc.arduino.IDE2"
#     # - "com.slack.Slack"
#   tags:
#     - apps
#     - flatpak


